# Задание №7. Нагрузка, стресс и отказоустойчивость

## Что такое нагрузочное тестирование, тестирование отказоустойчивости и стресс-тестирование? Что их отличает друг от друга?

1. **Нагрузочное тестирование** заключается в проверке работы приложения при большой нагрузке, то есть при высоком количестве параллельных запросов. Оно позволяет определить, на какой точке насыщения выходит приложение из строя и как быстро развивается его производительность при увеличении количества пользователей. Примером может служить проверка работы онлайн-магазина в период большого скидочного предложения.

2. **Тестирование отказоустойчивости** направлено на проверку, насколько хорошо приложение справляется с сбоями и отказами в работе. Оно позволяет определить, насколько быстро система восстанавливается после сбоя и как ведёт себя приложение при возникновении критических ошибок. Примером может служить проверка работы резервной базы данных в случае выхода из строя основной.

3. **Стресс-тестирование** заключается в проверке, насколько хорошо приложение справляется с экстремальной нагрузкой и условиями. Это может быть проверка работы приложения при очень большой базе данных или при постоянных перебоях в связи с низкой скоростью подключения к интернету пользователей. Примером может служить проверка работы биржи криптовалют в условиях большой волатильности рынка.

| Нагрузочное тестирование (Load Testing)                                                                                                                                                                                                                      | Тестирование отказоустойчивости (Failover Testing)                                                                                                                                                                                                                                | Стресс-тестирование (Stress Testing)                                                                                                                                                                                         |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Нагрузочное тестирование предполагает проверку работы системы при нагрузке, близкой к максимальной. Оно позволяет определить, как система работает в условиях повышенной нагрузки и может ли она обрабатывать запросы от большого количества пользователей.  |  Тестирование отказоустойчивости уделяет особое внимание проверке возможных ситуаций отказов и их последствий.                                                                                                                                                                    | стресс-тестирование заключается в тестировании системы, когда она находится на грани и за ее пределами. То есть, ее работа проверяется в крайне экстремальных условиях, которые вряд ли могут возникнуть в боевых условиях.  |
| Целью нагрузочного тестирования является определение максимальной загрузки, которую система может выдержать.                                                                                                                                                 | Тестирование отказоустойчивости - это проверка способности системы продолжать работать при возникновении сбоев в работе компонентов. Основная цель этого тестирования - обеспечение надежности системы, т.е. ее способности работать в условиях часто возникающих ошибок и сбоев. | стресс-тестирование проводится для определения пределов работы системы, когда она перегружена или неспособна обработать запрошенные данные.                                                                                  |
| Нагрузочное тестирование проводится для определения производительности системы в условиях повышенной нагрузки и настройки ее параметров на максимальную производительность.                                                                                  | тестирование отказоустойчивости оценивает, как система справляется с ошибками и сбоями в работе                                                                                                                                                                                   | Стресс-тестирование может выступать в качестве дополнительного этапа нагрузочного тестирования, когда система тестируется на чрезвычайно высокой нагрузке для проверки ее стабильности и надежности.                         |
| Нагрузочное тестирование фокусируется на проверке работы системы в обычных условиях, когда ее нагрузка высокая                                                                                                                                               | тестирование отказоустойчивости определяется при заданной нагрузке                                                                                                                                                                                                                | Стресс-тестирование, с другой стороны, проводится для проверки способности системы справляться со стрессом и выживать в экстремальных условиях, которые редко возникают.                                                     |
| нагрузочное тестирование сосредоточено на определении ее износостойкости в условиях высокой нагрузки                                                                                                                                                         | тестирование отказоустойчивости изучается устойчивость оговоренного уровня обслуживания                                                                                                                                                                                           | стресс-тестирование предоставляет более экстремальные тестовые условия.                                                                                                                                                      |
|                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                              |

## Приведите по одному примеру выполнения каждого из трёх видов тестирования (в контексте проверки базы данных большого веб-приложения).

Нагрузочное тестирование  используется для проверки производительности сайта или приложения при большом количестве пользователей и транзакций. Пример выполнения нагрузочного тестирования может выглядеть следующим образом:

1. Определение целей тестирования: какой максимальный поток пользователей и транзакций можно обрабатывать без потерь производительности и стабильности.

2. Взаимодействие с заказчиком: уточнение требуемых характеристик и критериев успешности тестирования.

3. Подготовка тестовых данных: создание сценария обмена информацией между пользованиями и сервисами, например, на основе использования популярных браузеров, платежных систем, соцсетей и т.д.

4. Настойка инструментария нагрузочного тестирования: включает в себя установку программного обеспечения, настройку тестовых машин, проведение мониторинга процессов и другие действия.

5. Выполнение тестов: проверка производительности приложения, установление временных показателей, определение уровня стабильности системы и другие метрики.

6. Анализ результатов: оценка полученных результатов, выявление проблем производительности приложений, определение недостатков инфраструктуры.

7. Отчет о тестировании: сообщение об ошибках, проблемных местах, заключения о выполненных метриках и других результатов.

8. Подготовка рекомендаций: на основе обнаруженных недостатков и рисков разработка рекомендаций по усовершенствованию приложения и его инфраструктуры, с целью повышения производительности и устойчивости работы.



# Пример выполнения тестирования отказоустойчивости может выглядеть следующим образом:

Шаг 1: Определить сценарии отказов

Первым шагом необходимо определить сценарии отказов, которые могут произойти с базой данных веб-приложения. Например:

- Потеря соединения с базой данных
- Недоступность базы данных из-за проблем с сетью
- Невозможность записи данных в базу из-за исчерпания максимального количества соединений
- Потеря данных в базе из-за сбоев в работе базы или хранения данных
- Нарушение целостности данных в базе из-за ошибок в приложении или базе данных

Шаг 2: Подготовить среду для тестирования

Для тестирования отказоустойчивости базы данных необходимо подготовить соответствующую тестовую среду. Это может включать в себя следующие действия:

- Создание отдельной тестовой базы данных
- Настройка параметров базы данных для симуляции отказов (например, искусственное ограничение на количество соединений)
- Настройка инструментов мониторинга для отслеживания состояния базы данных

Шаг 3: Выполнить тестовые сценарии

Для выполнения тестирования отказоустойчивости базы данных необходимо выполнить тестовые сценарии, которые были определены на первом шаге. Например:

- Отключение базы данных на несколько минут и проверка, как веб-приложение переживает отсутствие базы данных
- Установка ограничения на количество соединений и проверка, как веб-приложение обрабатывает запросы в условиях ограничения
- Имитация сбоя в работе базы данных и проверка, как веб-приложение переживает потерю данных
- Проверка, как веб-приложение обрабатывает запросы при нарушении целостности данных

Шаг 4: Анализ результатов

После выполнения тестовых сценариев необходимо проанализировать результаты и определить, насколько отказоустойчива база данных веб-приложения. Если были обнаружены проблемы, следует провести дополнительные тесты и исправить ошибки. Если база данных показала хорошие результаты, можно считать, что веб-приложение готово к работе с большими объемами данных и способно пережить некоторые типы отказов.

# Пример выполнения стресс-тестирования может выглядеть следующим образом:

Представим, что у нас есть интернет-магазин, который мы хотим протестировать на выдержку при большом количестве пользователей. Мы будем использовать специальное программное обеспечение, которое будет генерировать большое количество запросов на сайт одновременно, чтобы создать нагрузку на сервер. 

Шаги, которые мы будем выполнять:

1. Подготовка тестовой среды: мы настраиваем сервер и приложение для работы в тестовом режиме. Мы также создаем базу данных, которая будет использоваться для тестирования.

2. Создание сценария тестирования: мы определяем, какие действия будут выполняться во время тестирования. Например, мы можем создать сценарий добавления товаров в корзину, оформления заказа, выполнения поиска.

3. Выполнение теста: мы запускаем программное обеспечение для генерации запросов на сервер. Мы определяем количество пользователей и время, в течение которого тест будет выполняться. 

4. Анализ результатов: мы анализируем данные, полученные в результате тестирования, чтобы определить, какое количество пользователей может обслуживать сервер без сбоев. Мы также анализируем время отклика сервера, чтобы понимать, насколько быстро сайт будет работать при большой нагрузке. 

5. Устранение проблем: если тест выявил проблемы, мы предпринимаем меры для их устранения. Например, мы можем оптимизировать код приложения или увеличить количество серверов, чтобы распределить нагрузку.

Таким образом, стресс-тестирование поможет нам определить, какое количество пользователей может обслуживать сервер без проблем и как быстро будет работать сайт при большой нагрузке. Это позволит нам улучшить производительность и стабильность нашего интернет-магазина и обеспечить наилучший опыт покупателям.


## С помощью каких инструментов можно провести нагрузочное тестирование базы данных?

| Название программы             | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Apache JMeter                  | Это простой в использовании распределенный инструмент нагрузочного тестирования. Он может помочь вам определить время отклика и выяснить, сколько пользователей способна обрабатывать система одновременно. В качестве языка сценариев используется Python.Такие инструменты, как JMeter, основаны на ресурсоемкой потоковой архитектуре. Locust использует событийно-ориентированный подход, потребляющий меньше ресурсов.Для тех, кто знает, что такое «генераторы нагрузки»: Locust использует такую вещь, как «swarm» (англ. locust — «саранча», а swarm — «рой»). То есть вы направляете рой саранчи, чтобы создать нагрузку на ваш сайт.Для каждого из экземпляров Locust можно отдельно определить желаемое поведение. Это также дает вам возможность отслеживать процесс роения в режиме реального времени (в веб-интерфейсе). |
| Taurus                         | Сила Taurus в том, что он позволяет писать тесты на YAML.Полноценный сценарий можно описать примерно в десяти строках текста, а это дает командам возможность описывать свои тесты в файлах YAML или JSON. Таким образом вы получите удобочитаемые описания тестов в простых текстовых файлах.  Это большой шаг вперед по сравнению с прежними временами, когда для написания сценариев для измерения времени загрузки приходилось создавать большие и специфические инструменты.                                                                                                                                                                                                                                                                                                                                                      |
| Locust                         | Это простой в использовании распределенный инструмент нагрузочного тестирования. Он может помочь вам определить время отклика и выяснить, сколько пользователей способна обрабатывать система одновременно. В качестве языка сценариев используется Python.Такие инструменты, как JMeter, основаны на ресурсоемкой потоковой архитектуре. Locust использует событийно-ориентированный подход, потребляющий меньше ресурсов.Для тех, кто знает, что такое «генераторы нагрузки»: Locust использует такую вещь, как «swarm» (англ. locust — «саранча», а swarm — «рой»). То есть вы направляете рой саранчи, чтобы создать нагрузку на ваш сайт.Для каждого из экземпляров Locust можно отдельно определить желаемое поведение. Это также дает вам возможность отслеживать процесс роения в режиме реального времени (в веб-интерфейсе). |
| Fiddler с BlackWidow и Watcher | В списке инструментов для нагрузочного тестирования эта связка может показаться странной. Тем не менее, ее можно успешно использовать для быстрого запуска автоматизированного тестирования производительности.С помощью Fiddler вы можете делать много всего, но, вероятно, лучше всего описать его как инструмент захвата трафика.Хотя Fiddler сам по себе нельзя рассматривать как решение для нагрузочного тестирования, у него есть много функций, позволяющих отлаживать проблемы с сайтом, а с одним из его многочисленных расширений вы можете добиться еще большего.                                                                                                                                                                                                                                                          |
| nGrinder                       | На странице nGrinder на GitHub он описывается как решение для инженерии производительности корпоративного уровня. Он был создан для упрощения стресс-тестирования и как платформа, позволяющая создавать, выполнять и отслеживать тесты.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| The Grinder                    | The Grinder — это фреймворк на основе Java. Он предоставляет простые в использовании  решения для распределенного тестирования с использованием множества машин-генераторов нагрузки для определения времени отклика конечных пользователей. Вам не придется беспокоиться о каких-либо ограничениях виртуальных пользователей.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Gatling                        | Gatling — это инструмент нагрузочного тестирования, написанный на Scala и построенный на базе Akka и Netty.Этот инструмент позволяет тестировать и измерять сквозную производительность  приложения и легко масштабировать виртуальных пользователей.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| k6                             | Это ориентированный на разработчиков инструмент нагрузочного тестирования для  вашей внутренней инфраструктуры. Его также можно использовать для включения тестирования производительности в CI/CD-пайплайныЭтот инструмент создан с использованием Go и JavaScript, поэтому хорошо интегрируется в рабочий процесс большинства разработчиков.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Tsung                          | Это распределенная система нагрузочного тестирования, написанная на Erlang.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Siege                          | Это утилита командной строки для нагрузочного тестирования HTTP и тестирования производительности. Она призвана помочь разработчикам в оценке производительности их кода в условиях стрессовой нагрузки.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Bees with Machine Guns         | Bees with Machine Guns переводится как «пчелы с пулеметами». Это разработка Chicago Tribune.Bees with Machine Guns описывается как утилита для вооружения (создания) множества пчел (микроэкземпляры Amazon EC2) для атаки (нагрузочный тест) целей (веб-приложений).Этот инструмент может помочь вам провести нагрузочное тестирование сайта, который должен обрабатывать высокий трафик.Когда вы делаете замеры производительности на своей машине, все запросы к приложению поступают с одного IP-адреса.Это неэффективно для тестирования балансировки нагрузки.Bees with Machine Guns позволяет ввести пару команд и симулировать трафик, приходящий из нескольких разных источников.                                                                                                                                             |
| Fortio                         | Это библиотека для нагрузочного тестирования, инструмент командной строки, расширенный эхо-сервер и веб-интерфейс. Написан на языке Go.Этот инструмент позволяет задать посекундную нагрузку и записывать гистограммы задержки и другую полезную статистику.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Puppeteer                      | Во фронтенде современных приложений интенсивно используется JavaScript. Это повышает необходимость в тестировании производительности фронтенда.Для сбора статистики веб-производительности (например, для отслеживания загрузки страницы), получения трассировки DevTools со снимками экрана, получения показателей производительности во время выполнения вы можете использовать Puppeteer.Puppeteer — это библиотека Node, предлагающая высокоуровневый API для управления браузером Chrome или Chromium без пользовательского интерфейса, поверх протокола DevTools. В репозитории Puppeteer WebPerf вы найдете рецепты для автоматизации замеров веб-производительности с помощью Puppeteer.                                                                                                                                       |
| Flood Element                  | Масштабируемый  инструмент нагрузочного тестирования с использованием реальных браузеров. Такой подход позволяет более точно имитировать то, как реальные пользователи взаимодействуют с вашим приложением.Flood Element генерирует нагрузку путем запуска тысяч экземпляров Chromium, Firefox или Webkit.В ходе тестирования можно делать все так же, как делают реальные пользователи, открывая браузер и взаимодействуя с элементами страницы. Это может помочь найти проблемы, с которыми сталкивается пользователь.Flood Element создан на основе библиотеки автоматизации Playwright, благодаря чему отличается высокой скоростью и кроссбраузерной поддержкой. Сценарии создаются с использованием TypeScript.                                                                                                                  |
| Artillery                      | Это open-source приложение с премиум-сервисами, позволяющими создавать нагрузочные тесты для имитации нагрузки от тысяч пользователей. С помощью Artillery вы сможете получить подробные отчеты о разных показателях производительности: задержках запросах в секунду конкурентности среднем времени отклика пропускной способности. Инструмент позволяет прописывать пользовательскую логику и сценарии предварительного тестирования с использованием JavaScript, который имеет широкий спектр доступных NPM-модулей.Artillery поддерживает несколько протоколов, включая HTTP, Web Socket, Socket.IO, Kinesis и HLS.                                                                                                                                                                                                                |



## Какие существуют способы оптимизации (улучшения производительности) базы данных?

Существуют различные способы оптимизации базы данных, которые могут значительно улучшить ее производительность:

Индексирование базы данных - создание индексов для быстрого поиска данных.

Нормализация - разделение таблиц на отдельные сущности для уменьшения дублирования данных и повышения производительности.

Оптимизация запросов - использование оптимизатора запросов, написание эффективных запросов и устранение избыточных запросов.

Правильный выбор типов данных - использование подходящих типов данных для колонок таблицы, что позволяет сохранять память и повышает производительность.

Разделение на разные таблицы - использование разных таблиц для разных типов данных, что позволяет улучшить производительность.

Кеширование - использование кэша для хранения результата запросов, что может значительно уменьшить время выполнения запросов.

Партиционирование - разделение таблиц на разные части для более быстрого доступа к данным.

Масштабирование - разделение базы данных на несколько серверов, что позволяет распределить нагрузку и повысить производительность.

Анализ производительности - использование инструментов для мониторинга производительности базы данных и поиска узких мест для оптимизации.